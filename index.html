<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vault-Tec Records — Terminal</title>
  <meta name="description" content="Classified logs, holotapes, and wasteland field notes." />
  <meta name="theme-color" content="#0aff9d" />
  <style>
    :root{--fg:#0aff9d;--bg:#02170e;--dim:#0a5c44;--link:#8dffd7;--accent:#e2ffe4;--scan:rgba(255,255,255,.04)}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .shell{max-width:980px;margin:0 auto;padding:16px}
    .brand{display:flex;align-items:baseline;gap:12px}
    .brand h1{margin:0;font-size:clamp(18px,2.6vw,30px);letter-spacing:.12em}
    .sub{opacity:.75;font-size:.9em} .pipdot{color:var(--accent)}
    .panel{border:1px solid var(--dim);border-radius:16px;padding:16px;box-shadow:0 0 0 1px var(--dim) inset}
    .btn{border:1px solid var(--dim);background:transparent;color:var(--fg);padding:6px 10px;border-radius:10px;cursor:pointer}
    .hidden{display:none} .foot{opacity:.8;font-size:.9em} .status{font-weight:700}
    /* CRT scanlines */
    .scanlines::before{content:"";position:fixed;inset:0;pointer-events:none;background:linear-gradient(0deg,var(--scan) 1px,transparent 1px) repeat;background-size:100% 3px;mix-blend-mode:soft-light;opacity:.35}
    @media (prefers-reduced-motion: reduce){ .scanlines{display:none} }
    /* Boot overlay */
    .boot{position:fixed;inset:0;background:var(--bg);color:var(--fg);z-index:9999;display:flex;align-items:center;justify-content:center}
    .boot-inner{width:min(920px,92vw);padding:16px;border:1px solid var(--dim);border-radius:16px;box-shadow:0 0 0 1px var(--dim) inset}
    .boot-logo{margin:0 0 8px;color:var(--accent);line-height:1}
    .boot-lines{min-height:160px;white-space:pre-wrap}
    .boot-progress{height:8px;background:var(--dim);border-radius:999px;overflow:hidden;margin-top:10px}
    .boot-progress>i{display:block;height:100%;width:0%;background:var(--fg)}
    .boot-skip{margin-top:10px}
    /* Accordion */
    .accordion{display:grid;gap:10px}
    .acc-item{border:1px solid var(--dim);border-radius:12px;overflow:hidden}
    .acc-header{display:flex;align-items:center;gap:10px;padding:12px 14px;cursor:pointer;user-select:none}
    .acc-header:hover{background:rgba(255,255,255,.05)}
    .acc-arrow{transition:transform .18s ease} .acc-arrow.open{transform:rotate(90deg)}
    .acc-title{font-weight:700}
    .acc-panel{display:none;border-top:1px dashed var(--dim);padding:8px 14px}
    .acc-panel.open{display:block}
    .chap-list{list-style:none;margin:8px 0 0;padding:0;display:grid;gap:6px}
    .chap-list a{color:var(--fg);text-decoration:none;border:1px solid var(--dim);border-radius:10px;padding:6px 8px;display:flex;justify-content:space-between}
    .chap-list a:hover{background:rgba(255,255,255,.04)}
    .chap-missing{opacity:.6}
  </style>
</head>
<body>
  <!-- Boot Overlay -->
  <div id="boot" class="boot hidden" aria-live="polite" aria-label="Terminal boot sequence">
    <div class="boot-inner">
      <pre id="boot-logo" class="boot-logo" aria-hidden="true"></pre>
      <div id="boot-lines" class="boot-lines" role="status"></div>
      <div class="boot-progress"><i></i></div>
      <button id="boot-skip" class="btn boot-skip" aria-label="Skip (Esc)">Skip ▷</button>
    </div>
  </div>

  <div class="scanlines" aria-hidden="true"></div>

  <header class="shell">
    <div class="brand">
      <span class="pipdot">●</span>
      <h1>VAULT-TEC RECORDS</h1>
      <span class="sub">TERMINAL ACCESS</span>
    </div>
  </header>

  <main class="shell panel">
    <h2>Stories</h2>
    <div class="accordion" id="acc"></div>
  </main>

  <footer class="shell foot">
    <div class="status" id="status">READY▌</div>
  </footer>

  <script>
    /* ==================== BOOT-RESILIENT INDEX (NO FREEZE) ==================== */
    const el = s => document.querySelector(s);
    const els = s => Array.from(document.querySelectorAll(s));
    const safe = fn => { try { fn(); } catch(_) {} };

    const statusEl  = el('#status');
    function setStatus(t){ if(statusEl){ statusEl.textContent = (t||'READY')+'▌'; } }

    // ---- Data: point at your actual flat HTML files in the repo root.
    // Harper’s Ferry (HF43) — exact names from your screenshot
    const HF43 = [
      { title: "Chapter 1 — The Good Life in Harper’s Ferry", href: "hf43-chapter-1-the-good-life-in-harper-s-ferry.html" },
      { title: "Chapter 2 — Erased",                           href: "hf43-chapter-2-erased.html" },
      { title: "Chapter 3 — The Forgotten Tunnels",            href: "hf43-chapter-3-the-forgotten-tunnels.html" },
      { title: "Chapter 4 — Forty-Two",                        href: "hf43-chapter-4-forty-two.html" },
      { title: "Chapter 5 — The Founder",                      href: "hf43-chapter-5-the-founder.html" },
      { title: "Chapter 6 — Year One",                         href: "hf43-chapter-6-year-one.html" },
      { title: "Chapter 7 — The Founder (Tightened)",          href: "hf43-chapter-7-the-founder-tightened.html" },
      { title: "Chapter 8 — Aimee",                            href: "hf43-chapter-8-aimee.html" }
    ];

    // Shelter 21 + Holotape singles (present in your repo)
    const SHELTER21 = [{ title: "Shelter 21 Café", href: "shelter21.html" }];
    const HOLO      = [{ title: "Holotape",        href: "holo.html" }];

    // No Home in the Waste — filenames in screenshot are truncated; we’ll auto-discover.
    // Give each chapter a set of likely prefixes; we’ll probe and keep the first that exists.
    const WASTE_PREFIXES = [
      { title: "Chapter 1 — The Road",   candidates: ["no-home-in-the-waste-chapter-1-the-road",  "no-home-in-the-waste-chapter-1-"] },
      { title: "Chapter 2 — The Cabin",  candidates: ["no-home-in-the-waste-chapter-2-the-cabin", "no-home-in-the-waste-chapter-2-"] },
      { title: "Chapter 3 — The Memory", candidates: ["no-home-in-the-waste-chapter-3-the-mem",   "no-home-in-the-waste-chapter-3-"] },
      { title: "Chapter 4 — The Green",  candidates: ["no-home-in-the-waste-chapter-4-the-gree",  "no-home-in-the-waste-chapter-4-"] },
      { title: "Chapter 5 — The Change", candidates: ["no-home-in-the-waste-chapter-5-the-chan",  "no-home-in-the-waste-chapter-5-"] }
    ];

    // Helper to try possible filenames (same folder). We test a few common suffixes.
    async function resolveChapterHref(prefixes){
      const suffixes = [".html", ".htm", ".xhtml", ".HTML"];
      for(const p of prefixes){
        for(const s of suffixes){
          const url = `${p}${s}`;
          try{
            const r = await fetch(url, {method:'HEAD', cache:'no-store'});
            if(r.ok) return url;
          }catch(_){}
        }
      }
      return null;
    }

    async function buildWasteList(){
      const list = [];
      for(const ch of WASTE_PREFIXES){
        const href = await resolveChapterHref(ch.candidates);
        list.push({ title: ch.title, href, missing: !href });
      }
      return list;
    }

    // Final story list (we’ll fill WASTE dynamically)
    const STORIES = [
      { title: "HF43 — Harper’s Ferry Mystery", chapters: HF43 },
      { title: "No Home in the Waste", chapters: null }, // filled later
      { title: "Shelter 21 Café", chapters: SHELTER21 },
      { title: "Holotape", chapters: HOLO }
    ];

    // ---- Boot animation (once per tab, 6s hard fallback)
    const bootEl    = el('#boot');
    const bootLogo  = el('#boot-logo');
    const bootLines = el('#boot-lines');
    const bootBar   = el('.boot-progress>i');
    const bootSkip  = el('#boot-skip');
    const reduced   = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const BOOT_TIMEOUT_MS = 6000;

    const BOOT_LOGO = String.raw`
 __     ___       _ _ _   _____            _                 _     
 \ \   / (_)_   _(_) | | | ____|_ __   ___| |__   ___   ___ | |__  
  \ \ / /| \ \ / / | | | |  _| | '_ \ / __| '_ \ / _ \ / _ \| '_ \ 
   \ V / | |\ V /| | | | | |___| | | | (__| | | | (_) | (_) | |_) |
    \_/  |_| \_/ |_|_|_| |_____|_| |_|\___|_| |_|\___/ \___/|_.__/ 
`;
    const BOOT_LINES = [
      "Initializing Vault-Tec interface ... OK",
      "Mounting holotape archives ... OK",
      "Decrypting pre-war records ... OK",
      "Routing terminals ... OK",
      "Linking chapter files ... OK",
      "Granting user access ... OK"
    ];

    function typeLine(target, text, speed=12){
      return new Promise(resolve=>{
        if(!target){ return resolve(); }
        if(reduced){ target.textContent += text + "\n"; return resolve(); }
        let i=0; const iv=setInterval(()=>{
          target.textContent += text[i++] || "";
          if(i>=text.length){ clearInterval(iv); target.textContent += "\n"; resolve(); }
        }, speed);
      });
    }

    let bootDone = false;
    function endBoot(){
      if(bootDone) return;
      bootDone = true;
      safe(()=> bootEl.classList.add('hidden'));
      setStatus('READY');
      renderMenu();
    }

    async function runBoot(){
      // Skip if reduced motion or we already showed this in this tab
      if(!bootEl || reduced || sessionStorage.getItem('vtr.bootSeen') === '1'){ endBoot(); return; }

      const killer = setTimeout(endBoot, BOOT_TIMEOUT_MS); // failsafe
      safe(()=> bootEl.classList.remove('hidden'));
      safe(()=> bootLogo.textContent = BOOT_LOGO);

      for(let i=0;i<BOOT_LINES.length;i++){
        const line = document.createElement('div');
        safe(()=> bootLines.appendChild(line));
        await typeLine(line, BOOT_LINES[i]);
        safe(()=> bootBar && (bootBar.style.width = Math.round(((i+1)/BOOT_LINES.length)*100)+'%'));
        await new Promise(r=> setTimeout(r, 120));
      }
      clearTimeout(killer);
      sessionStorage.setItem('vtr.bootSeen', '1');
      endBoot();
    }

    safe(()=> bootSkip && bootSkip.addEventListener('click', endBoot));
    window.addEventListener('keydown', e=>{ if(e.key==='Escape' && bootEl && !bootEl.classList.contains('hidden')) endBoot(); });

    // ---- Render accordion
    function renderMenu(){
      const root = document.getElementById('acc');
      if(!root) return;

      root.innerHTML = STORIES.map(story => {
        const inner = (story.chapters||[]).map(c => {
          if(c.missing){
            return `<li><span class="chap-missing"><span>${c.title}</span><span>missing</span></span></li>`;
          }
          return `<li><a href="${c.href}"><span>${c.title}</span><span>▶</span></a></li>`;
        }).join('');
        return `
          <div class="acc-item">
            <div class="acc-header" role="button" aria-expanded="false" tabindex="0">
              <span class="acc-arrow">▸</span>
              <span class="acc-title">${story.title}</span>
            </div>
            <div class="acc-panel">
              <ul class="chap-list">${inner}</ul>
            </div>
          </div>
        `;
      }).join('');

      // collapse by default; toggle on click/Enter/Space
      els('.acc-header').forEach(h=>{
        const panel = h.parentElement.querySelector('.acc-panel');
        const arrow = h.querySelector('.acc-arrow');
        function toggle(){
          const open = panel.classList.toggle('open');
          panel.style.display = open ? 'block' : 'none';
          arrow.classList.toggle('open', open);
          h.setAttribute('aria-expanded', String(open));
        }
        h.addEventListener('click', toggle);
        h.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); toggle(); }});
      });
    }

    // ---- Init: resolve “No Home in the Waste” filenames, then boot
    (async function init(){
      setStatus('BOOTING');
      STORIES[1].chapters = await buildWasteList(); // fill “No Home in the Waste”
      await runBoot();
    })();
  </script>
</body>
</html>
